name: "tractoflow"
description: |
  This subworkflow implements the TractoFlow [1] pipeline. It can process raw diffusion and T1 weighted image to reduce
  acquisition biases, align anatomical and diffusion space, compute DTI and fODF metrics and generate whole brain
  tractograms.

  ----------  Configuration  ----------

  - nextflow.config : contains an example configuration for the subworkflow. Imports modules.config.
  - modules.config : contains the bindings to the modules parameters and some defaults making it Tractoflow.

  --------------  Steps  --------------

  1. PREPROCESS DWI (preproc_dwi, nf-neuro)
    Preprocess the DWI image including brain extraction, MP-PCA denoising, eddy current and motion correction, N4 bias
    correction, normalization and resampling.
  2. PREPROCESS T1 (preproc_t1, nf-neuro)
    Preprocess the T1 image including brain extraction, NL-Means denoising, bias field correction and resampling.
  3. T1 REGISTRATION (anatomical_registration, nf-neuro)
    Register the T1 image to the DWI image, using the b0 and the FA map as target for the diffusion space.
  4. SEGMENTATION (anatomical_segmentation, nf-neuro)
    Segment the T1 image into white matter, gray matter and CSF, in diffusion space.
  5. DTI FITTING (dipy)
    Fit the diffusion tensor model on the preprocessed DWI image and extract relevant metrics.
  6. FRF ESTIMATION (scilpy)
    Estimate the Fiber Response Function (FRF) from the preprocessed DWI image.
  7. FODF FITTING (dipy)
    Fit the Fiber Orientation Distribution Function (fODF), using Single or Multi Shell, Single or Multi Tissues models,
    on the preprocessed DWI image and extract relevant metrics.
  8. PFT TRACKING (dipy)
    Perform Particle Filtering Tractography (PFT) on the FODF to generate whole brain tractograms.
  9. LOCAL TRACKING (dipy on CPU, scilpy on GPU)
    Perform Local Tracking on the FODF to generate whole brain tractograms.

  [1] https://tractoflow-documentation.readthedocs.io
keywords:
  - diffusion
  - MRI
  - end-to-end
  - tractography
  - preprocessing
  - fodf
  - dti
components:
  - anatomical_segmentation
  - preproc_dwi
  - preproc_t1
  - registration
  - reconst/dtimetrics
  - reconst/frf
  - reconst/fodf
  - reconst/qball
  - reconst/meanfrf
  - registration/antsapplytransforms
  - tracking/localtracking
  - tracking/pfttracking
  - utils_options
args:
  - b0_max_threshold:
      type: float
      description: Maximum b-value threshold to consider as b0 volumes.
      default: 10
  - bvalue_tolerance:
      type: float
      description: Tolerance for b-value shell extraction and processing.
      default: 20
  - dwi_signal_sh_fit:
      type: boolean
      description: Enable spherical harmonics fitting of the DWI signal.
      default: true
  - dwi_signal_sh_fit_order:
      type: integer
      description: Spherical harmonics order for DWI signal fitting.
      default: 6
  - dwi_signal_sh_fit_basis:
      type: string
      description: Spherical harmonics basis for DWI signal fitting.
      choices:
        - descoteaux07
        - descoteaux07_legacy
        - tournier07
        - tournier07_legacy
      default: "descoteaux07"
  - dwi_signal_sh_fit_shell:
      type: boolean
      description: Fit spherical harmonics on specific shell instead of all shells.
      default: false
  - dwi_denoise_patch_size:
      type: integer
      description: Patch size for MP-PCA denoising algorithm.
      default: 7
  - dwi_topup_config_file:
      type: string
      description: Configuration file for TOPUP processing (e.g., "b02b0.cnf").
      default: "b02b0.cnf"
  - dwi_eddy_executable:
      type: string
      description: EDDY executable to use (e.g., "eddy_cpu" or "eddy_cuda10.2").
      choices:
        - eddy_cpu
        - eddy_cuda10.2
      default: "eddy_cpu"
  - dwi_eddy_restore_slices:
      type: boolean
      description: Enable slice-wise outlier detection and replacement in EDDY.
      default: true
  - preproc_t1_run_denoising:
      type: boolean
      description: Enable NL-Means denoising of the T1 image.
      default: true
  - preproc_t1_run_N4:
      type: boolean
      description: Enable N4 bias field correction for T1 image.
      default: true
  - preproc_t1_run_synthstrip:
      type: boolean
      description: Enable SynthStrip brain extraction for T1 image.
      default: false
  - preproc_t1_run_ants_bet:
      type: boolean
      description: Enable ANTs-based brain extraction for T1 image.
      default: true
  - preproc_t1_run_crop:
      type: boolean
      description: Enable cropping of the T1 image to remove padding.
      default: true
  - preproc_t1_run_resampling:
      type: boolean
      description: Enable resampling of the T1 image to isotropic resolution.
      default: true
  - t1_resample_resolution_mm_iso:
      type: integer
      description: Isotropic resolution in mm for T1 resampling.
      default: 1
  - t1_resample_interpolation:
      type: string
      description: Interpolation method for T1 resampling (e.g., "lin", "cubic").
      choices:
        - nn
        - lin
        - quad
        - cubic
      default: "lin"
  - dwi_n4_knot_interval:
      type: integer
      description: Number of voxels between splines' knots for DWI N4 bias correction.
      default: 1
  - dwi_n4_subsampling:
      type: integer
      description: Subsampling factor for DWI N4 bias correction.
      default: 2
  - dwi_resample_resolution_mm_iso:
      type: integer
      description: Isotropic resolution in mm for DWI resampling.
      default: 1
  - dwi_resample_interpolation:
      type: string
      description: Interpolation method for DWI resampling (e.g., "lin", "cubic").
      choices:
        - nn
        - lin
        - quad
        - cubic
      default: "lin"
  - dti_max_bvalue:
      type: integer
      description: Maximum b-value to consider for DTI shell extraction.
      default: 1200
  - dti_shells_to_fit:
      type: string
      description: Specific shells to use for DTI fitting (e.g., "0,1000" for b-values).
      default: null
  - fodf_min_bvalue:
      type: integer
      description: Minimum b-value to consider for fODF shell extraction.
      default: 700
  - fodf_shells_to_fit:
      type: string
      description: Specific shells to use for fODF fitting (e.g., "0,1000,2000" for b-values).
      default: null
  - frf_fa_max_threshold:
      type: float
      description: Maximum FA threshold for fiber response function estimation.
      default: 0.7
  - frf_fa_min_threshold:
      type: float
      description: Minimum FA threshold for fiber response function estimation.
      default: 0.5
  - frf_min_n_voxels:
      type: integer
      description: Minimum number of voxels required for FRF estimation.
      default: 300
  - frf_roi_radius:
      type: integer
      description: ROI radius in mm for fiber response function estimation.
      default: 20
  - frf_value_to_force:
      type: string
      description: Force specific FRF values instead of estimation (e.g., "15,4,4" for eigenvalues).
      default: null
  - fodf_sh_order:
      type: integer
      description: Spherical harmonics order for fODF reconstruction (must be even).
      default: 8
  - fodf_sh_basis:
      type: string
      description: Spherical harmonics basis for fODF reconstruction.
      choices:
        - descoteaux07
        - descoteaux07_legacy
        - tournier07
        - tournier07_legacy
      default: "descoteaux07"
  - fodf_peaks_absolute_factor:
      type: float
      description: Absolute threshold factor for fODF peak extraction.
      default: 2.0
  - fodf_peaks_relative_threshold:
      type: float
      description: Relative threshold for fODF peak extraction.
      default: 0.1
  - fodf_peaks_ventricle_max_fa:
      type: float
      description: Maximum FA value for ventricle mask creation.
      default: 0.1
  - fodf_peaks_ventricle_min_md:
      type: float
      description: Minimum MD value for ventricle mask creation.
      default: 0.003
  - pft_random_seed:
      type: integer
      description: Random seed for PFT tractography reproducibility.
      default: 0
  - pft_algorithm:
      type: string
      description: Algorithm to use for PFT tractography (e.g., "prob", "det").
      choices:
        - prob
        - det
      default: "prob"
  - pft_step_mm:
      type: float
      description: Step size in mm for PFT tractography.
      default: 0.5
  - pft_theta_max_deviation:
      type: integer
      description: Maximum angular deviation in degrees for PFT tracking.
      default: 20
  - pft_min_streamline_length:
      type: integer
      description: Minimum streamline length in mm for PFT tracking.
      default: 20
  - pft_max_streamline_length:
      type: integer
      description: Maximum streamline length in mm for PFT tracking.
      default: 200
  - pft_seeding_type:
      type: string
      description: Tissue type for PFT seeding mask generation (e.g., "wm", "fa").
      choices:
        - wm
        - interface
        - fa
      default: "wm"
  - pft_seeding_strategy:
      type: string
      description: Seeding strategy for PFT tractography (e.g., "npv", "nt").
      choices:
        - npv
        - nt
      default: "npv"
  - pft_number_of_seeds:
      type: integer
      description: Number of seeds per voxel - npv (or total - nt) for PFT tracking.
      default: 10
  - pft_fa_min_threshold:
      type: float
      description: Minimum FA threshold for PFT tracking.
      default: 0.1
  - pft_number_of_particles:
      type: integer
      description: Number of particles for PFT algorithm.
      default: 15
  - pft_backward_step_mm:
      type: integer
      description: Backward step size in mm for PFT tracking.
      default: 2
  - pft_forward_step_mm:
      type: integer
      description: Forward step size in mm for PFT tracking.
      default: 1
  - pft_compression_step_mm:
      type: float
      description: Compression step size in mm for PFT streamlines.
      default: 0.2
  - lt_processor:
      type: string
      description: Processor type for local tracking (e.g., "cpu", "gpu").
      choices:
        - cpu
        - gpu
      default: "cpu"
  - lt_gpu_batch_size:
      type: integer
      description: Batch size for GPU-based local tracking.
      default: 10000
  - lt_random_seed:
      type: integer
      description: Random seed for local tracking reproducibility.
      default: 0
  - lt_algorithm:
      type: string
      description: Algorithm to use for local tractography (e.g., "prob", "det").
      choices:
        - prob
        - det
        - ptt
        - eudx
      default: "prob"
  - lt_step_mm:
      type: float
      description: Step size in mm for local tracking.
      default: 0.5
  - lt_theta_max_deviation:
      type: integer
      description: Maximum angular deviation in degrees for local tracking.
      default: 20
  - lt_min_streamline_length:
      type: integer
      description: Minimum streamline length in mm for local tracking.
      default: 20
  - lt_max_streamline_length:
      type: integer
      description: Maximum streamline length in mm for local tracking.
      default: 200
  - lt_seeding_type:
      type: string
      description: Tissue type for local tracking seeding mask generation (e.g., "wm", "fa").
      choices:
        - wm
        - fa
      default: "wm"
  - lt_seeding_strategy:
      type: string
      description: Seeding strategy for local tractography (e.g., "npv", "nt").
      choices:
        - npv
        - nt
      default: "npv"
  - lt_number_of_seeds:
      type: integer
      description: Number of seeds per voxel for local tracking.
      default: 10
  - lt_fa_min_threshold_for_seeding:
      type: float
      description: Minimum FA threshold for local tracking seeding mask.
      default: 0.1
  - lt_tracking_type:
      type: string
      description: Tissue type for local tracking mask generation (e.g., "wm", "fa").
      choices:
        - wm
        - fa
      default: "wm"
  - lt_fa_min_threshold_for_tracking:
      type: float
      description: Minimum FA threshold for local tracking mask.
      default: 0.1
  - lt_compression_step_mm:
      type: float
      description: Compression step size in mm for local tracking streamlines.
      default: 0.2
input:
  - ch_dwi:
      type: file
      description: |
        The input channel containing the DWI file, B-values and B-vectors in FSL format files.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dwi:
            type: file
            description: DWI file.
        - bval:
            type: file
            description: B-values file.
        - bvec:
            type: file
            description: B-vectors file.
  - ch_t1:
      type: file
      description: |
        The input channel containing the anatomical T1 weighted image.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - t1:
            type: file
            description: T1-weighted image file.
  - ch_sbref:
      type: file
      description: |
        The input channel containing the single-band b0 reference for the DWI.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - rev_b0:
            type: file
            description: Single-band b0 reference file.
      mandatory: false
  - ch_rev_dwi:
      type: file
      description: |
        The input channel containing the reverse DWI file, B-values and B-vectors in FSL format files.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - rev_dwi:
            type: file
            description: Reverse-encoded DWI file.
        - bval:
            type: file
            description: B-values file.
        - bvec:
            type: file
            description: B-vectors file.
      mandatory: false
  - ch_rev_sbref:
      type: file
      description: |
        The input channel containing the reverse b0 file.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - rev_b0:
            type: file
            description: Reverse b0 file.
      mandatory: false
  - ch_aparc_aseg:
      type: file
      description: |
        The input channel containing freesurfer brain segmentation and gray matter parcellation (aparc+aseg).
        Must be supplied with ch_wm_parc. When supplied, those are used to generate tissues masks and probability maps.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - aparc_aseg:
            type: file
            description: FreeSurfer aparc+aseg parcellation file.
      mandatory: false
  - ch_wm_parc:
      type: file
      description: |
        The input channel containing freesurfer white matter parcellations (wmparc). Must be supplied with
        ch_aparc_aseg. When supplied, those are used to generate tissues masks and probability maps.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - wmparc:
            type: file
            description: FreeSurfer white matter parcellation file.
      mandatory: false
  - ch_topup_config:
      type: file
      description: |
        The input channel containing the config file for Topup. This input is optional.
        See https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/topup/TopupUsersGuide#Configuration_files.
      structure:
        - config_file:
            type: file
            description: Topup configuration file.
      mandatory: false
  - ch_bet_template:
      type: file
      description: |
        The input channel containing the anatomical template for antsBET.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - bet_template:
            type: file
            description: ANTs BET template file.
      mandatory: false
  - ch_bet_probability_map:
      type: file
      description: |
        The input channel containing the brain probability mask for antsBET,
        with intensity range 1 (definitely brain) to 0 (definitely background).
      structure:
        - meta:
            type: map
            description: Metadata map.
        - probability_map:
            type: file
            description: Brain probability mask file.
      mandatory: false
  - ch_synthstrip_weights:
      type: file
      description: |
        The input channel containing the SynthStrip model weights for brain extraction.
      structure:
        - meta:
            type: map
            description: Metadata map (optional).
        - synthstrip_weights:
            type: file
            description: SynthStrip model weights file.
      mandatory: false
  - ch_lesion_mask:
      type: file
      description: |
        The input channel containing the lesion mask for segmentation.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - lesion_mask:
            type: file
            description: Lesion mask file.
      mandatory: false
  - options:
      type: map
      description: |
        Map of options for the subworkflow.
      entries:
        preproc_dwi_run_denoising:
          type: boolean
          description: If 'true', the DWI will be denoised using the MPPCA method from MRtrix3.
          default: true
        preproc_dwi_run_degibbs:
          type: boolean
          description: If 'true', the Gibbs artifact removal will be performed using the mrdegibbs method from MRtrix3.
          default: true
        topup_eddy_run_topup:
          type: boolean
          description: If 'true', the Topup correction will be performed using FSL's Topup.
          default: true
        topup_eddy_run_eddy:
          type: boolean
          description: If 'true', the Eddy correction will be performed using FSL's Eddy.
          default: true
        preproc_dwi_run_synthstrip:
          type: boolean
          description: If 'true', the brain extraction will be performed using SynthStrip. If 'false', FSL's BET will be used.
          default: false
        preproc_dwi_keep_dwi_with_skull:
          type: boolean
          description: If 'true', the DWI before brain extraction will be kept and used for the following steps. If 'false', the DWI after brain extraction will be used for the following steps.
          default: false
        preproc_dwi_run_N4:
          type: boolean
          description: If 'true', the N4 bias field correction will be performed using ANTs' N4BiasFieldCorrection.
          default: true
        preproc_dwi_run_normalize:
          type: boolean
          description: If 'true', the DWI will be normalized to have a mean value in the WM of approximately 1000 using MRtrix3's dwinormalise.
          default: true
        preproc_dwi_run_resampling:
          type: boolean
          description: If 'true', the DWI will be resampled to 1 mm isotropic spatial resolution using DIPY's resample.
          default: true
        preproc_t1_run_denoising:
          type: boolean
          description: If 'true', the anatomical image will be denoised using the nlmeans method from scilpy.
          default: true
        preproc_t1_run_N4:
          type: boolean
          description: If 'true', the N4 bias field correction will be performed using the N4BiasFieldCorrection method from ANTs.
          default: true
        preproc_t1_run_resample:
          type: boolean
          description: If 'true', the anatomical image will be resampled using the resample method from DIPY.
          default: true
        preproc_t1_run_synthstrip:
          type: boolean
          description: If 'true', the subworkflow will use SynthStrip for brain extraction.
          default: false
        preproc_t1_run_ants_bet:
          type: boolean
          description: If 'true', the subworkflow will use ANTs' BET for brain extraction.
          default: true
        preproc_t1_run_crop:
          type: boolean
          description: If 'true', the subworkflow will crop the image after brain extraction.
          default: true
        frf_average_from_data:
          type: boolean
          description: If 'true', the fiber response function will be averaged across all subjects. If 'false', the fiber response function will be estimated for each subject independently.
          default: false
        run_qball:
          type: boolean
          description: If 'true', the Q-Ball model will be fitted on the DWI data and used for fODF reconstruction and tracking.
          default: false
        use_qball_for_tracking:
          type: boolean
          description: If 'true', the Q-Ball model will be used for tractography instead of the fODF model. This option is only relevant if run_qball is 'true'.
          default: false
        run_pft_tracking:
          type: boolean
          description: If 'true', Particle Filtering Tractography (PFT) will be performed using DIPY.
          default: true
        run_local_tracking:
          type: boolean
          description: If 'true', Local Tracking will be performed.
          default: false
      mandatory: true
output:
  - dwi:
      type: file
      description: |
        Preprocessed DWI image.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dwi:
            type: file
            description: Preprocessed DWI file.
        - bval:
            type: file
            description: B-values file.
        - bvec:
            type: file
            description: B-vectors file.
  - t1:
      type: file
      description: |
        T1 image warped to the DWI space.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - t1:
            type: file
            description: T1 image in DWI space.
  - wm_mask:
      type: file
      description: |
        White matter mask.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - wm_mask:
            type: file
            description: White matter mask file.
  - gm_mask:
      type: file
      description: |
        Gray matter mask.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - gm_mask:
            type: file
            description: Gray matter mask file.
  - csf_mask:
      type: file
      description: |
        Cerebrospinal fluid mask.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - csf_mask:
            type: file
            description: CSF mask file.
  - wm_map:
      type: file
      description: |
        White matter probability map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - wm_map:
            type: file
            description: White matter probability map file.
  - gm_map:
      type: file
      description: |
        Gray matter probability map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - gm_map:
            type: file
            description: Gray matter probability map file.
  - csf_map:
      type: file
      description: |
        Cerebrospinal fluid probability map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - csf_map:
            type: file
            description: CSF probability map file.
  - aparc_aseg:
      type: file
      description: |
        Freesurfer brain segmentation and gray matter parcellation (aparc+aseg) in diffusion space. Only
        available if ch_aparc_aseg is provided in inputs.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - aparc_aseg:
            type: file
            description: FreeSurfer aparc+aseg in diffusion space.
      mandatory: false
  - wmparc:
      type: file
      description: |
        Freesurfer white matter parcellations (wmparc) in diffusion space. Only available if ch_wm_parc
        is provided in inputs.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - wmparc:
            type: file
            description: FreeSurfer wmparc in diffusion space.
      mandatory: false
  - anatomical_to_diffusion:
      type: file
      description: |
        Transformation matrix from the anatomical space to the diffusion space.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - warp:
            type: file
            description: Warp field file.
        - affine:
            type: file
            description: Affine transformation file.
  - diffusion_to_anatomical:
      type: file
      description: |
        Transformation matrix from the diffusion space to the anatomical space.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - affine:
            type: file
            description: Affine transformation file.
        - warp:
            type: file
            description: Warp field file.
  - t1_native:
      type: file
      description: |
        Preprocessed T1 in anatomical space.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - t1:
            type: file
            description: T1 in native anatomical space.
  - dti_tensor:
      type: file
      description: |
        4-D Diffusion tensor image, with 6 components in the last dimensions, ordered by FSL convention
        (row-major : Dxx, Dxy, Dxz, Dyy, Dyz, Dzz).
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_tensor:
            type: file
            description: DTI tensor file.
  - dti_md:
      type: file
      description: |
        Mean diffusivity map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_md:
            type: file
            description: Mean diffusivity file.
  - dti_rd:
      type: file
      description: |
        Radial diffusivity map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_rd:
            type: file
            description: Radial diffusivity file.
  - dti_ad:
      type: file
      description: |
        Axial diffusivity map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_ad:
            type: file
            description: Axial diffusivity file.
  - dti_fa:
      type: file
      description: |
        Fractional anisotropy map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_fa:
            type: file
            description: Fractional anisotropy file.
  - dti_rgb:
      type: file
      description: |
        RGB map of the diffusion tensor.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_rgb:
            type: file
            description: DTI RGB file.
  - dti_peaks:
      type: file
      description: |
        Principal direction of the diffusion tensor.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_peaks:
            type: file
            description: DTI peaks file.
  - dti_evecs:
      type: file
      description: |
        Eigenvectors of the diffusion tensor, ordered by eigenvalue.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_evecs:
            type: file
            description: DTI eigenvectors file.
  - dti_evals:
      type: file
      description: |
        Eigenvalues of the diffusion tensor.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_evals:
            type: file
            description: DTI eigenvalues file.
  - dti_residual:
      type: file
      description: |
        Residuals of the diffusion tensor fitting.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_residual:
            type: file
            description: DTI residual file.
  - dti_ga:
      type: file
      description: |
        Generalized anisotropy map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_ga:
            type: file
            description: Generalized anisotropy file.
  - dti_mode:
      type: file
      description: |
        Mode of the diffusion tensor.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_mode:
            type: file
            description: DTI mode file.
  - dti_norm:
      type: file
      description: |
        Norm of the diffusion tensor.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - dti_norm:
            type: file
            description: DTI norm file.
  - fiber_response:
      type: file
      description: |
        Fiber Response Function (FRF) estimated from the DWI image.
        If using Single Tissue: contains fiber_response file.
        If using Multi Tissues: contains wm_fiber_response, gm_fiber_response, and csf_fiber_response files.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - fiber_response:
            type: file
            description: Single-tissue FRF file (when not using multi-tissue).
        - wm_fiber_response:
            type: file
            description: White matter FRF file (multi-tissue).
        - gm_fiber_response:
            type: file
            description: Gray matter FRF file (multi-tissue).
        - csf_fiber_response:
            type: file
            description: CSF FRF file (multi-tissue).
  - fodf:
      type: file
      description: |
        Fiber Orientation Distribution Function (fODF) estimated from the DWI image.
        If using Single Tissue: contains fodf file.
        If using Multi Tissues: contains wm_fodf, gm_fodf, and csf_fodf files.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - fodf:
            type: file
            description: Single-tissue fODF file (when not using multi-tissue).
        - wm_fodf:
            type: file
            description: White matter fODF file (multi-tissue).
        - gm_fodf:
            type: file
            description: Gray matter fODF file (multi-tissue).
        - csf_fodf:
            type: file
            description: CSF fODF file (multi-tissue).
  - fodf_rgb:
      type: file
      description: |
        RGB map of the fODF, normalized by volume fraction of WM.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - fodf_rgb:
            type: file
            description: fODF RGB file.
  - fodf_peaks:
      type: file
      description: |
        Peaks of the fODF.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - fodf_peaks:
            type: file
            description: fODF peaks file.
  - afd_max:
      type: file
      description: |
        Maximum Apparent Fiber Density (AFD) map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - afd_max:
            type: file
            description: AFD max file.
  - afd_total:
      type: file
      description: |
        Total Apparent Fiber Density (AFD) map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - afd_total:
            type: file
            description: AFD total file.
  - afd_sum:
      type: file
      description: |
        Sum of Apparent Fiber Density (AFD) map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - afd_sum:
            type: file
            description: AFD sum file.
  - nufo:
      type: file
      description: |
        Number of Unique Fibers Orientations (NUFO) map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - nufo:
            type: file
            description: NUFO file.
  - volume_fraction:
      type: file
      description: |
        Tissues volume fraction map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - volume_fraction:
            type: file
            description: Tissues volume fraction file.
  - qball:
      type: file
      description: |
        Qball spherical harmonics coefficients.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - qball:
            type: file
            description: Qball SH coefficients file.
      mandatory: false
  - qball_a_power:
      type: file
      description: |
        Anisotropic power map.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - qball_a_power:
            type: file
            description: Qball anisotropic power file.
      mandatory: false
  - qball_peaks:
      type: file
      description: |
        Extracted peaks from Qball model.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - qball_peaks:
            type: file
            description: Qball peaks file.
      mandatory: false
  - qball_peaks_indices:
      type: file
      description: |
        Generated peaks indices on the sphere from Qball model.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - qball_peak_indices:
            type: file
            description: Qball peak indices file.
      mandatory: false
  - qball_gfa:
      type: file
      description: |
        Generalized fractional anisotropy.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - qball_gfa:
            type: file
            description: Qball GFA file.
      mandatory: false
  - qball_nufo:
      type: file
      description: |
        NUFO map from Qball model.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - qball_nufo:
            type: file
            description: Qball NUFO file.
      mandatory: false
  - pft_tractogram:
      type: file
      description: |
        Whole brain tractogram generated with Particle Filtering Tractography (PFT).
      structure:
        - meta:
            type: map
            description: Metadata map.
        - pft_tractogram:
            type: file
            description: PFT tractogram file.
      mandatory: false
  - pft_config:
      type: file
      description: |
        Configuration file used for Particle Filtering Tractography (PFT).
      structure:
        - meta:
            type: map
            description: Metadata map.
        - pft_config:
            type: file
            description: PFT configuration file.
      mandatory: false
  - pft_map_include:
      type: file
      description: |
        Include map used for Particle Filtering Tractography (PFT).
      structure:
        - meta:
            type: map
            description: Metadata map.
        - pft_map_include:
            type: file
            description: PFT include map file.
      mandatory: false
  - pft_map_exclude:
      type: file
      description: |
        Exclude map used for Particle Filtering Tractography (PFT).
      structure:
        - meta:
            type: map
            description: Metadata map.
        - pft_map_exclude:
            type: file
            description: PFT exclude map file.
      mandatory: false
  - pft_seeding_mask:
      type: file
      description: |
        Seeding mask used for Particle Filtering Tractography (PFT).
      structure:
        - meta:
            type: map
            description: Metadata map.
        - pft_seeding_mask:
            type: file
            description: PFT seeding mask file.
      mandatory: false
  - local_tractogram:
      type: file
      description: |
        Whole brain tractogram generated with Local Tracking.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - local_tractogram:
            type: file
            description: Local tractogram file.
      mandatory: false
  - local_config:
      type: file
      description: |
        Configuration file used for Local Tracking.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - local_config:
            type: file
            description: Local tracking configuration file.
      mandatory: false
  - local_seeding_mask:
      type: file
      description: |
        Seeding mask used for Local Tracking.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - local_seeding_mask:
            type: file
            description: Local tracking seeding mask file.
      mandatory: false
  - local_tracking_mask:
      type: file
      description: |
        Tracking mask used for Local Tracking.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - local_tracking_mask:
            type: file
            description: Local tracking mask file.
      mandatory: false
  - mqc:
      type: file
      description: |
        QC files (png, gif, etc.) generated by all modules that can
        be leveraged in a subject-level MultiQC report.
      structure:
        - meta:
            type: map
            description: Metadata map.
        - mqc_files:
            type: file
            description: MultiQC files.
      mandatory: false
  - global_mqc:
      type: file
      description: |
        QC files (txt, npy, etc.) generated by all modules that can
        be leveraged in a global-level MultiQC report (all subjects).
      structure:
        - meta:
            type: map
            description: Metadata map.
        - global_mqc_files:
            type: file
            description: Global MultiQC files.
      mandatory: false
  - versions:
      type: file
      description: |
        File containing software versions
      structure:
        - versions:
            type: file
            description: Versions YAML file.
      pattern: "versions.yml"
authors:
  - "@AlexVCaron"
maintainers:
  - "@AlexVCaron"
